<!DOCTYPE html>
<html>
    <body>
        <h1 id="categoria">Categoria</h1>
        <section id="container-productos">
            <div id="producto">
                <img
                    src="https://clientes.tecnoactive.cl/cms/Retail/MenuboardBonmestre/Img/Producto1.png"
                    alt="Producto 1" />
                <h2>Producto 1</h2>
                <p id="descripcion">Descripción del Producto 1</p>
                <p id="precio">$Precio 1</p>
            </div>
            <div id="producto">
                <img
                    src="https://clientes.tecnoactive.cl/cms/Retail/MenuboardBonmestre/Img/Producto2.png"
                    alt="Producto " />
                <h2>Producto 2</h2>
                <p id="descripcion">Descripción del Producto 2</p>
                <p id="precio">$Precio 2</p>
            </div>
        </section>
    </body>
</html>

<style>
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(100%);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    body {
        background-image: url("https://clientes.tecnoactive.cl/cms/Retail/MenuboardBonmestre/Img/Pantalla6.jpg");
        background-size: cover;
        background-repeat: no-repeat;
    }

    h1 {
        margin-top: 130px;
        font-size: 50px;
        text-align: center;
    }

    #container-productos {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        margin-top: 20px;
    }

    #producto {
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin: 50px;
        width: 650px;
        height: 850px;
        text-align: center;
        animation: slideIn 1s ease-out;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #producto img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
    }

    #producto h2 {
        font-size: 36px;
        margin: 10px 0;
    }

    #descripcion {
        font-size: 24px;
        color: #555;
    }

    #precio {
        font-size: 28px;
        color: #000;
        font-weight: bold;
    }
</style>

<script type="module">
    try {
        async function obtenerPlatos() {
            const response = await fetch("./data/platos.json");
            if (!response.ok) {
                throw new Error("Error al cargar el archivo JSON");
            }
            return await response.json();
        }

        function obtenerCategorias(platos) {
            return Object.keys(platos);
        }

        function mostrarProductosDeCategoria(
            categoria,
            platos,
            productoIndex,
            productosPorPagina
        ) {
            const container = document.getElementById("container-productos");
            const titulo = document.getElementById("categoria");
            titulo.textContent = categoria;

            const productosCategoria = platos[categoria];
            const productosAMostrar = productosCategoria.slice(
                productoIndex,
                productoIndex + productosPorPagina
            );

            container.innerHTML = productosAMostrar
                .map(
                    (p) => `
            <div id="producto">
                <img src="${p.img || ""}" alt="${p.alt || p.nombre || ""}" />
                <h2>${p.nombre || "Sin nombre"}</h2>
                <p id="descripcion">${p.descripcion || ""}</p>
                <p id="precio">${p.precio ? "$" + p.precio : ""}</p>
            </div>
        `
                )
                .join("");
        }

        function iniciarCarruselCategorias(
            categorias,
            platos,
            productosPorPagina = 2
        ) {
            let categoriaIndex = 0;
            let productoIndex = 0;

            function mostrarSiguiente() {
                const categoriaActual = categorias[categoriaIndex];
                const productosCategoria = platos[categoriaActual];

                mostrarProductosDeCategoria(
                    categoriaActual,
                    platos,
                    productoIndex,
                    productosPorPagina
                );

                productoIndex += productosPorPagina;
                if (productoIndex >= productosCategoria.length) {
                    productoIndex = 0;
                    categoriaIndex = (categoriaIndex + 1) % categorias.length;
                }
            }

            mostrarSiguiente();
            setInterval(mostrarSiguiente, 5000);
        }

        (async () => {
            try {
                const platos = await obtenerPlatos();
                const categorias = obtenerCategorias(platos);
                iniciarCarruselCategorias(categorias, platos, 2);
            } catch (error) {
                console.error("Error al iniciar el carrusel:", error);
            }
        })();
    } catch (error) {
        console.error("Error al verificar usuario:", error);
    }
</script>
